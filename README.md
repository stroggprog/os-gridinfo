# os-gridinfo
Returns a JSON object of grid information for MySQL/MariaDB based OpenSimulator instances

**Version**: `1.0.1`
```
1.0.0

Minimum OpenSimulator version: 0.9.2
```
**WARNING**: Requires backend access to the grid database!

May work with earlier versions of OpenSimulator, but this has not been tested.

# Index
[About](#about)
[Configuration](#configuration)
[Calling](#calling)
[Sample Output](#sample_output)

## About
[Back to Top](#os-gridinfo)

This script, when invoked, will return a JSON object with the following information:
- Total number of regions
- Number of registered Grid Gods
- Number of Grid Gods currently online
- Number of user accounts
- Number of (local) users online
- Total number of users online (users + gods) excluding HyperGrid visitors
- Number of HyperGrid visitors currently active within the grid
- Grid Status (true if one or more regions are online)
- Total land area in m²
- The regions are listed in an array with the following info:
  - Name of region
  - x-coordinate (grid coordinates)
  - y-coordinate
  - size (expressed in multiples of 256)
  - public status (i.e. no access restrictions)

The `size` is expressed in standard region sizes, so:
- 1 = '1 x 1' or '256m x 256m' or 65,536m²
- 2 = '2 x 2' or '512m x 512m' or 262,144m²
- 4 = '4 x 4' or '1024m x 1024m' or 1,048,576m²

## Configuration
[Back to Top](#os-gridinfo)

Simply copy the files to your web space on the same machine as the database, then edit `lib/db_params.php` to set your database parameters. You should also take the opportunity to change the value of the `SECRET` defined in the same file. You should then be good to go.

## Calling
[Back to Top](#os-gridinfo)

Assuming the URI to your file is `http://mydomain.org/gridinfo.php`, you'll need to call it with the secret. You can pass this in either POST or GET parameters using the token `pw` and setting the correct value.

For example, if you use GET, and the secret is `IAmABadSecret`:
```
http://mydomain.org/gridinfo.php?pw=IAmABadSecret
```

Note that the value of `pw` should be urlencoded (`llEscapeURL()` if called from LSL) if it may contain any non-alphanumeric characters.

If `pw` does not match `SECRET`, the JSON returned will contain a single element:
```json
{
  "error": "naughty access"
}
```
If there is no error, then the object should be fully populated. In this case, the value of `error` will be `OK`.

The `regionlist` data can be quite extensive if you have dozens of regions or more, and may cause memory issues or content overflow errors with LSL scripts. You can prevent the `regionlist` array from being generated by passing an additional parameter `regionlist` with the value `no`:
```
http://mydomain.org/gridinfo.php?pw=IAmABadSecret&regionlist=no
```

Note the data will still be processed in order to correctly update the `landarea` value, but the region array will not be included in the output.

# Sample Output
[Back to Top](#os-gridinfo)

```json
{
    "error": "OK",
    "regions": 2,
    "gods": 3,
    "godsonline": 1,
    "users": 6,
    "usersonline": 2,
    "totalonline": 3,
    "grid": 1,
    "gstatus": true,
    "landarea": 1114112,
    "regionlist": [
        {
            "name": "Moss",
            "coordx": 1000,
            "coordy": 1000,
            "size": 4,
            "public": true
        },
        {
            "name": "Shop",
            "coordx": 1009,
            "coordy": 1000,
            "size": 1,
            "public": true
        }
    ]
}
```
[Back to Top](#os-gridinfo)
